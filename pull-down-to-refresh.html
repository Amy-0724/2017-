<!DOCTYPE html>
<html lang="zh">

<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
	<meta name="format-detection" content="telephone=no">
	<title>下拉刷新</title>
	<meta name="description" content="amy0724-下拉刷新">
	<meta name="keywords" content="下拉刷新">
	<meta name="robots" content="INDEX,FOLLOW">
	<link rel="stylesheet" href="pull-down-to-refresh/dropload.css">

</head>

<body>
	<style media="screen">

	</style>
<div class="page1">
	我只是路人甲
</div>
<div class="page1">
	我只是路人乙
</div>
<div class="page1">
	我只是路人丙
</div>
<div class="page2">
	就是这里
</div>
	<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
	<script src="pull-down-to-refresh/dropload.min.js" charset="utf-8"></script>
	<script type="text/javascript">
	//下拉刷新
$(function() {
	// 页数
	var page = 0;
	// 每页展示10个
	var size = 10;
	// dropload
	$('.page2').dropload({
			scrollArea: window,
			loadDownFn: function(me) {
				page++;
				// 拼接HTML
				var result = '';
					//("ajax success");
					$.ajax({
							type: 'GET',
							url: '/',//这里需要放接口文件
							contentType: "application/json; charset=utf-8",
							dataType: "json",
							success: function(data) {
								//console.log(data);
								var arrLen = data.length;
								//console.log(arrLen)
									if(arrLen > 0){
										//console.log(2)
											for (var i = 0; i < arrLen; i++) {

												$(".lazy").detach();
													result += '<div class="col-md-6 col-sm-6 col-xs-6">'
															+'<a href="#" class="commodity-links">'
															+'<img src="" data-src="img/mainImg.jpg" alt="" class="proportional-picture">'
															+'<div class="product-details">'
															+'<div class="Product-prices">'
															+'<p class="reference-font1 usually_price">'
															+'<span class="RMB-symbol">¥</span>'
															+'<span class="discounted_price">35.00</span>'
															+'</p>'
															+'</div>'
															+'<div class="product-content">'
															+'<p class="product-name">商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品商品</p>'
															+'<p class="An-ellipsis">...</p>'
															+'<p class="product-notes">'
															+'<img src="home_img/new.png" alt="" class="product-new">'
															+'<img src="home_img/sale.png" alt="" class="product-sale">'
															+'</p>'
															+'</div>'
															+'</div>'
															+'</a>'
															+'</div>';
													//这里是商品图片啦加载的效果
													var lazy ='<div class="lazy">'
													+'<script type="text/javascript">'
													+'function lazyload() {'
													+'var imgs = document.getElementsByClassName("proportional-picture");'
													+'H = window.innerHeight;'
													 //浏览器视窗高度
													+'var S = document.documentElement.scrollTop || document.body.scrollTop;' //滚动条滚过高度
													+'[].forEach.call(imgs, function(img) {'
													+"if (!img.getAttribute('data-src')) {"
													+'return'
													+'} '//已经替换过的跳过
													+'if (H + S - 20 > getTop(img)) {' //为达到演示效果，这里H+S减去200，延后加载时机
													+'img.src = img.getAttribute("data-src");'
													+'img.removeAttribute("data-src");'
													+'}'
													+'});'
													+'[].every.call(imgs, function(img) {'
													+"return !img.getAttribute('data-src')"
													+'}) && (window.removeEventListener("scroll", lazyload, false)); '//完成所有替换后注销事件
													+'}'
													+'window.addEventListener("scroll", lazyload, false);'
													+'window.addEventListener("load", lazyload, false);'
													+'function getTop(e) {'
													+'var T = e.offsetTop;'
													+'while (e = e.offsetParent) {'
													+'T += e.offsetTop'
													+'}'
													+'return T'
													+'}'
													+'</script>'
													+'</div>';
											}
											//console.log(result)
											$(".Hot-single-product-specific.row").append(result);
											$(".Hot-single-product-specific.row").append(lazy);
									////console.log(3)
									// 如果没有数据
								} else {
											// 锁定
											me.lock();
											// 无数据
											me.noData();
											//console.log(4)
									}
										//console.log(5)
									// 为了测试，延迟1秒加载
									setTimeout(function(){
											// 插入数据到页面，放到最后面
											$('.lists').append(result);
											// 每次数据插入，必须重置
											me.resetload();
									},1000);
									//console.log(6)
							},
							error: function(xhr, type){
									// alert('Ajax error!');
									// 即使加载出错，也得重置
									me.resetload();
										//console.log(7)
							}
					});
			}
	});
});
	</script>
</body>

</html>
